{% extends 'parasitologyTool/base.html' %}
{% load static %}

{% block title_block %}clinical parasite page{% endblock %}

{% block body_block %}
    <!--<link rel="stylesheet" href="{% static 'css/posts.css' %}"> -->
<style type="text/css">
    body {
        background: #E5E5E5;
    }

    .top-text {
        background: white; border-radius: 5px; padding: 15px; margin-bottom: 10px; font-size: 20px; width: 810px;
    }
    
    .box {
        float: left;
    }

    .a-box {
        background: white; padding: 20px; border-radius: 5px;  width: 810px; margin-bottom: -10px; 
    }

    .a-s-box-author img {
        float: initial; width: 50px; height: 50px; border-radius: 50%;
    }

    .a-s-box-author {
        font-size: 15px;  padding-bottom: 10px; border-bottom: solid 0.5px silver;
    }

    .a-s-box-context {
        padding-left: 50px; border-bottom: solid 0.5px silver;
    }

    .a-s-box-context img {
         width: 180px; height: 180px; margin-right: 3px; margin-bottom: 3px; border-radius: 5px; object-fit: cover;
    }

    .a-s-box-bottom {
        width: 255px;  text-align: center; float: left; padding-top: 7px;
    }

    .rside {
        width: 460px; margin-left: 820px; background: white; border-radius: 5px;
    }
    
    .rside-box {
        margin-left: 13px; margin-right: 13px; border-bottom: solid 0.5px silver; padding-bottom: 10px; font-size: 13px; 
    }

    .rside p {
        font-size: 20px; padding: 7px; border-bottom: solid 0.5px silver;
    }

    .context{
        white-space: pre-line;
    }

</style>

<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
 <script type="text/javascript">
  $(document).ready(function(){
   var onoff = false;
   $('.item').each(function() {
    var article = $(this).find('.context');
    var str = article.html().replace(/<br>/g, "\n").replace(/<p>/g, "").replace(/<\/p>/g, "");
    var see = $(this).find('.see');
    if (str.length > 200) {
     article.text(str.substr(0, 200) + '......');
     see.text('Show All');  
    }
    see.click(function() {
     if (onoff) {
      article.text(str.substr(0, 200) + '......');
      see.text('Show All');
     } else {
      article.text(str);
      see.text('Show Less');
     }
     onoff = !onoff
    });
   });
  });
 </script>


<div class="box">
    <div class="top-text">
        <Strong>Welcome to the Research Parasite Page for {{ parasite.name }}</Strong>
    </div>
    <div>
        {% for post in research_posts %}
            <div class="a-box">
                <div class="a-s-box-author">
                    <img src="{% static 'images/researcher.jpeg' %}"
                                alt="picture of article" />  <stong>{{post.user.username}}</stong>
                </div>

                <div class="a-s-box-context">
                    <div class="item">
                        <div class="context">
                            {{ post.content|linebreaks|urlize }}
                        </div>
                        <span class="see" style="color: #409EFF;"></span>
                    </div>
  
                    {% if post.images %}
                        {% for image in post.images %}
                            <a href="{{ MEDIA_URL }}{{ image.image }}"><img src="{{ MEDIA_URL }}{{ image.image }}"></a>
                        {% endfor %}
                    {% endif %}
                    <br>
                    Reference Files List:
                    <br>
                    {% if post.files %}
                        {% for file in post.files %}
                            <a href="{{ MEDIA_URL }}{{ file.file }}">{{ file.file.name }}</a>
                        {% endfor %}
                    {% endif %}
                </div>
                
                
            

                <div class="a-s-box-bottom">
                    Share
                </div>
                <div class="a-s-box-bottom">
                    <a href="{% url 'parasitologyTool:research_post_page' parasite.id post.id %}">Comments</a>
                </div>
                <div class="a-s-box-bottom">
                    {% if user.is_authenticated %}
                    <button class="like_btn"
                                data-categoryid="{{ post.id }}"
                                type="button">
                    <span data-feather="thumbs-up"></span>
                    </button>
                    {% endif %}
                    <strong class="like_count">{{ post.likes }}</strong> likes 
                </div>
                <script type="text/javascript">
                    $(document).ready(function() { 
                        $('.like_btn').click(function() {
                            var postIdVar;
                            postIdVar = $(this).attr('data-categoryid');

                            $.get('/parasitologyTool/like_post/', 
                                {'post_id': postIdVar}, 
                                function(data) {
                                    $('.like_count').html(data);
                                    $('.like_btn').hide();
                                })
                        });
                    });
                </script>
                <br>
                <!-- forms for like and dislike buttons -->
                <form class="ajax-form-like" id="like" method="POST" data-url="{% url 'parasitologyTool:like' post.model post.id %}">
                    {% csrf_token %}
                    <button type="submit"><span data-feather="thumbs-up"></span><span class="like-count">{{post.likes.all.count}}</span></button>
                </form>
                <form class="ajax-form-dislike" id='dislike' method="POST" data-url="{% url 'parasitologyTool:dislike' post.model post.id %}">
                    {% csrf_token %}
                    <button type="submit"><span data-feather="thumbs-down"></span><span class="dislike-count"> {{post.dislikes.all.count}} </span></button>
                </form>
                <h3>{{post.model}}</h3>
            </div>
            &nbsp;
        {% endfor %}
    </div>
</div>

<div class="rside">
      <p><strong>Most Pupular Post</strong></p>

      <div class="rside-box">
      Example test
      </div>
     
</div>
    <div>
        <a href="{% url 'parasitologyTool:add_research_post' parasite.id %}">add post</a>
    </div>
<script src="{% static 'js/like_dislike_ajax.js' %}"></script>

{% endblock %}